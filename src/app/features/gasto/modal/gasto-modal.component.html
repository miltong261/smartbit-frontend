<div class="pt-4 px-4">

  <h2 class="text-2xl font-semibold text-gray-800 mb-6">
    Crear gasto
  </h2>

  <mat-dialog-content class="pb-4">

    <form [formGroup]="form" class="space-y-5">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Fecha <span class="text-red-600">*</span>
        </label>
        <input
          type="date"
          formControlName="fecha"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          [ngClass]="{
            'border-red-500 ring-red-300 ring-1': form.controls['fecha'].invalid && form.controls['fecha'].touched
          }"
        >
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Comercio <span class="text-red-600">*</span>
        </label>
        <input
          type="text"
          formControlName="nombreComercio"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          [ngClass]="{
            'border-red-500 ring-red-300 ring-1': form.controls['nombreComercio'].invalid && form.controls['nombreComercio'].touched
          }"
        >
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Tipo Documento <span class="text-red-600">*</span>
        </label>
        <select
          formControlName="tipoDocumento"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          [ngClass]="{
            'border-red-500 ring-red-300 ring-1': form.controls['tipoDocumento'].invalid && form.controls['tipoDocumento'].touched
          }"
        >
          <option value="" disabled selected>Seleccione un tipo</option>
          <option [value]="1">Comprobante</option>
          <option [value]="2">Factura</option>
          <option [value]="3">Otro</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Número Documento
        </label>
        <input
          type="text"
          formControlName="numeroDocumento"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
        >
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Fondo Monetario <span class="text-red-600">*</span>
        </label>
        <select
          formControlName="fondoMonetarioId"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          [ngClass]="{
            'border-red-500 ring-red-300 ring-1': form.controls['fondoMonetarioId'].invalid && form.controls['fondoMonetarioId'].touched
          }"
        >
          <option value="" disabled selected>Seleccione un fondo</option>
          <option *ngFor="let fm of fondosMonetarios" [value]="fm.id">{{ fm.nombre }}</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Observaciones
        </label>
        <textarea
          formControlName="observaciones"
          rows="2"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
        ></textarea>
      </div>

      <div class="border-t pt-4">
        <h3 class="text-lg font-semibold mb-2">Detalles</h3>

        <div class="flex gap-2 items-end mb-2">
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo Gasto</label>
            <select
              [(ngModel)]="detalle.tipoGastoId"
              [ngModelOptions]="{standalone: true}"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            >
              <option value="" disabled selected>Seleccione un tipo</option>
              <option *ngFor="let tg of tiposGasto" [value]="tg.id">{{ tg.nombre }}</option>
            </select>
          </div>

          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">Monto</label>
            <input
              type="number"
              [(ngModel)]="detalle.monto"
              [ngModelOptions]="{standalone: true}"
              min="0.01"
              step="0.01"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            >
          </div>

          <button
            type="button"
            class="px-3 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition"
            (click)="agregarDetalle()"
          >
            + Agregar
          </button>
        </div>

        <div class="overflow-x-auto mt-4">
          <table class="min-w-full border border-gray-200 rounded-lg">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Tipo de Gasto</th>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Monto (Q)</th>
                <th class="px-4 py-2 text-center text-sm font-medium text-gray-700">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of detalles; let i = index" class="bg-white border-b border-gray-200 hover:bg-gray-50">
                <td class="px-4 py-2 text-sm text-gray-800">
                  {{ getNombreTipoGasto(d.tipoGastoId) }}
                </td>
                <td class="px-4 py-2 text-sm text-gray-800">
                  {{ d.monto | number:'1.2-2' }}
                </td>
                <td class="px-4 py-2 text-center">
                  <button
                    type="button"
                    class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition"
                    (click)="quitarDetalle(i)"
                  >
                    ×
                  </button>
                </td>
              </tr>
              <tr *ngIf="detalles.length === 0">
                <td colspan="3" class="px-4 py-2 text-center text-gray-500">
                  No hay detalles agregados
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </form>

  </mat-dialog-content>

  <mat-dialog-actions align="end" class="pt-4">
    <button
      class="px-4 py-2.5 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition font-medium shadow-sm cursor-pointer"
      (click)="dialogRef.close(false)"
    >
      Cancelar
    </button>

    <button
      class="ml-3 px-5 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition font-medium shadow shadow-blue-200 disabled:opacity-50 cursor-pointer"
      [disabled]="loading"
      (click)="create()"
    >
      Guardar
    </button>
  </mat-dialog-actions>

</div>
